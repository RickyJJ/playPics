{
  "code": "import { Bitmap } from \"./Bitmap\";\r\nimport { Texture } from \"./Texture\";\r\nimport { Texture2D } from \"./Texture2D\";\r\nimport { ILaya } from \"../../ILaya\";\r\nimport { Browser } from \"../utils/Browser\";\r\nexport class HTMLCanvas extends Bitmap {\r\n    get source() {\r\n        return this._source;\r\n    }\r\n    _getSource() {\r\n        return this._source;\r\n    }\r\n    constructor(createCanvas = false) {\r\n        super();\r\n        if (createCanvas)\r\n            this._source = Browser.createElement(\"canvas\");\r\n        else {\r\n            this._source = this;\r\n        }\r\n        this.lock = true;\r\n    }\r\n    clear() {\r\n        this._ctx && this._ctx.clear && this._ctx.clear();\r\n        if (this._texture) {\r\n            this._texture.destroy();\r\n            this._texture = null;\r\n        }\r\n    }\r\n    destroy() {\r\n        super.destroy();\r\n        this._setCPUMemory(0);\r\n        this._ctx && this._ctx.destroy && this._ctx.destroy();\r\n        this._ctx = null;\r\n    }\r\n    release() {\r\n    }\r\n    get context() {\r\n        if (this._ctx)\r\n            return this._ctx;\r\n        if (this._source == this) {\r\n            this._ctx = new ILaya.Context();\r\n        }\r\n        else {\r\n            this._ctx = this._source.getContext(ILaya.Render.isConchApp ? 'layagl' : '2d');\r\n        }\r\n        this._ctx._canvas = this;\r\n        return this._ctx;\r\n    }\r\n    _setContext(context) {\r\n        this._ctx = context;\r\n    }\r\n    getContext(contextID, other = null) {\r\n        return this.context;\r\n    }\r\n    getMemSize() {\r\n        return 0;\r\n    }\r\n    size(w, h) {\r\n        if (this._width != w || this._height != h || (this._source && (this._source.width != w || this._source.height != h))) {\r\n            this._width = w;\r\n            this._height = h;\r\n            this._setCPUMemory(w * h * 4);\r\n            this._ctx && this._ctx.size && this._ctx.size(w, h);\r\n            if (this._source) {\r\n                this._source.height = h;\r\n                this._source.width = w;\r\n            }\r\n            if (this._texture) {\r\n                this._texture.destroy();\r\n                this._texture = null;\r\n            }\r\n        }\r\n    }\r\n    getTexture() {\r\n        if (!this._texture) {\r\n            var bitmap = new Texture2D();\r\n            bitmap.loadImageSource(this.source);\r\n            this._texture = new Texture(bitmap);\r\n        }\r\n        return this._texture;\r\n    }\r\n    toBase64(type, encoderOptions) {\r\n        if (this._source) {\r\n            if (ILaya.Render.isConchApp) {\r\n                var win = window;\r\n                if (win.conchConfig.threadMode == 2) {\r\n                    throw \"native 2 thread mode use toBase64Async\";\r\n                }\r\n                var width = this._ctx._targets.sourceWidth;\r\n                var height = this._ctx._targets.sourceHeight;\r\n                var data = this._ctx._targets.getData(0, 0, width, height);\r\n                return win.conchToBase64FlipY ? win.conchToBase64FlipY(type, encoderOptions, data.buffer, width, height) : win.conchToBase64(type, encoderOptions, data.buffer, width, height);\r\n            }\r\n            else {\r\n                return this._source.toDataURL(type, encoderOptions);\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    toBase64Async(type, encoderOptions, callBack) {\r\n        var width = this._ctx._targets.sourceWidth;\r\n        var height = this._ctx._targets.sourceHeight;\r\n        this._ctx._targets.getDataAsync(0, 0, width, height, function (data) {\r\n            let win = window;\r\n            var base64 = win.conchToBase64FlipY ? win.conchToBase64FlipY(type, encoderOptions, data.buffer, width, height) : win.conchToBase64(type, encoderOptions, data.buffer, width, height);\r\n            callBack(base64);\r\n        });\r\n    }\r\n}\r\n",
  "references": [
    "D:/MySpace/Projects/NextPresent/PresentNext/libs/laya/resource/Bitmap.ts",
    "D:/MySpace/Projects/NextPresent/PresentNext/libs/laya/resource/Texture.ts",
    "D:/MySpace/Projects/NextPresent/PresentNext/libs/laya/resource/Texture2D.ts",
    "D:/MySpace/Projects/NextPresent/PresentNext/libs/laya/resource/Context.ts",
    "D:/MySpace/Projects/NextPresent/PresentNext/libs/ILaya.ts",
    "D:/MySpace/Projects/NextPresent/PresentNext/libs/laya/utils/Browser.ts"
  ]
}
